# Документация к API для тестирования веб-сайтов

## 1. Техническое описание

### Архитектура API

API для тестирования веб-сайтов разрабатывается с использованием **FastAPI**, популярного фреймворка для создания API на Python. Основное назначение API — анализ двух ключевых метрик веб-сайтов: времени загрузки и коэффициента конверсии. Для этого используются две модели машинного обучения:

- **Модель для предсказания времени загрузки веб-сайта**.
- **Модель для предсказания коэффициента конверсии**.

Каждая модель загружается с использованием библиотеки **joblib**, которая позволяет работать с сериализованными объектами моделей, обученными заранее. Для предобработки данных применяется библиотека **Pandas**, что упрощает интеграцию с машинным обучением.

### Используемые технологии:
- **FastAPI** — основной фреймворк для построения API.
- **joblib** — для загрузки и сохранения обученных моделей.
- **requests** — для HTTP-запросов к веб-страницам с целью получения данных о времени загрузки и коэффициенте конверсии.
- **Pydantic** — для валидации входных данных и создания модели запроса.
- **pandas** — для предобработки данных.
- **re** — для валидации URL с использованием регулярных выражений.

## 2. Формат запросов и ответов

### 1. Формат запроса:
POST запрос на эндпоинт `/analyze/` с JSON телом, содержащим URL и тип запроса:
- `"loading"` — для анализа времени загрузки.
- `"conversion"` — для анализа коэффициента конверсии.

Пример запроса:

```json
{
  "url": "http://example.com",
  "request_type": "loading"
}
```

### 2. Формат ответа

API возвращает JSON-ответ с результатами анализа:

### Для запроса типа "loading":

```json
{
  "type": "loading",
  "url": "http://example.com",
  "loading_time": 2.45,
  "recommendation": "Скорость загрузки в пределах нормы. Рекомендуется оптимизировать изображения и кэширование."
}
```

### Для запроса типа "conversion":
```json
{
  "type": "conversion",
  "url": "http://example.com",
  "conversion_rate": 0.65,
  "recommendation": "Уровень коэффициента конверсии: Средний. Рекомендуем улучшить форму обратной связи и добавить призывы к действию."
}
```

## 2. Обучение моделей

### 2.1 Данные и метрики

### Модель для времени загрузки:
- **Источник данных:** Web Performance Metrics
- **Используемые фичи:**
  - **Load Time** (время загрузки страницы, сек)
  - **Page Size** (размер страницы, КБ)
  - **Throughput** (пропускная способность, запросы/сек)
- **Целевая переменная:** **Performance_Label** (категорический лейбл производительности)

### Модель для коэффициента конверсии:
- **Источник данных:** Web Page Performance
- **Используемые фичи:**
  - **Conversion Rate** (коэффициент конверсии)
  - **Bounce Rate** (показатель отказов)

### 2.2 Алгоритмы и гиперпараметры

- **Алгоритм:** Для обеих моделей использован алгоритм **Random Forest**.
- **Настройка гиперпараметров:** Выполнялась через кросс-валидацию, например, настройка количества деревьев в случайном лесе.

### 2.3 Важные шаги в процессе обучения

### Предобработка данных:
- **Модель времени загрузки:** Использовались данные о времени загрузки страницы и другие метрики производительности.
- **Модель коэффициента конверсии:** Использовались метрики, такие как количество изображений на странице, размер контента и количество заголовков.

### Метрики:
Для обеих моделей использовались стандартные метрики регрессии:
- **Mean Squared Error (MSE)**
- **R²** (коэффициент детерминации)

### 2.4 Датасеты

- **Модель времени загрузки:** Использовались данные о скорости загрузки веб-страниц.
- **Модель коэффициента конверсии:** Использовались данные о содержимом веб-страниц (например, количество изображений и заголовков).

### 2.5 Реализация моделей

Модели обучались с использованием алгоритма **Random Forest** для регрессии.

## 3. Пользовательское руководство

### 3.1 Развертывание API

Для развертывания API на локальной машине выполните следующие шаги:

1. Установите необходимые библиотеки:
```bash
pip install fastapi uvicorn joblib pandas requests
``` 

2. Загрузка моделей

Скачайте заранее обученные модели, например `model1.pkl` и `model2.pkl`, и разместите их в папке, указанной в коде (например, `D:/Web_testing_pj/Web_testing_api/models/`).

3. Запуск сервера
 
Для запуска FastAPI приложения выполните следующую команду в терминале:
	
```bash
uvicorn main:app --reload
```

API будет доступно по адресу: `http://127.0.0.1:8000/`.

4. Тестирование API

Вы можете использовать инструмент **Postman** или любой HTTP-клиент для отправки запросов к API.

Пример запроса для анализа времени загрузки:

```json
{
  "url": "http://example.com",
  "request_type": "loading"
}
```

### 3.2 Использование интерфейса (index.html)

Для работы с пользовательским интерфейсом выполните следующие шаги:

1. **Откройте файл `index.html` в браузере**.  
   Убедитесь, что API запущено и доступно для обработки запросов.

2. **Введите URL веб-сайта**, который нужно проанализировать.  
   Пример: `http://example.com`.

3. **Выберите тип запроса**:
   - "Время загрузки".
   - "Коэффициент конверсии".

4. **Нажмите кнопку "Тестировать"**.  
   Приложение отправит запрос к API и обработает данные.

5. **Просмотрите результат анализа**:  
   Отображается скорость загрузки или коэффициент конверсии, а также рекомендации по оптимизации.


### 3.3 Советы по интерпретации результатов

#### Время загрузки
- **Меньше 1.5 секунд**:  
  Сайт работает быстрее, чем 80–95% других сайтов. Оптимизация не требуется.
  
- **Между 1.5 и 3 секундами**:  
  Рекомендуется оптимизировать изображения и использовать кэширование.

- **Более 3 секунд**:  
  Сайт работает медленно. Требуется серьёзная оптимизация, включая минимизацию JavaScript, сжатие изображений и улучшение работы серверов.

#### Коэффициент конверсии
- **Высокий (>= 0.85)**:  
  Продолжайте в том же духе. Добавьте дополнительные призывы к действию для увеличения продаж.

- **Средний (0.5–0.85)**:  
  Улучшите форму обратной связи, добавьте четкие призывы к действию и улучшите пользовательский интерфейс.

- **Низкий (< 0.5)**:  
  Требуется улучшение контента, добавление промо-акций, обновление дизайна страницы и устранение возможных ошибок в юзабилити.

## 4. Дополнительные рекомендации

### Системные требования:
- **Python:** 3.8 или выше  
- **Операционная система:** Linux, Windows, macOS  
- **Библиотеки:**  
  - FastAPI  
  - Uvicorn  
  - Joblib  
  - Pandas  
  - Scikit-learn  
  - Requests  
  - Matplotlib  
  - Seaborn  

## 5. Часто задаваемые вопросы (FAQ)

### Как ускорить работу модели?
- Используйте более мощное оборудование или настройте сервер для асинхронной обработки запросов.  
- Примените методы оптимизации моделей, такие как кросс-валидация для выбора лучших гиперпараметров.  

### Что делать, если API не запускается?
- Убедитесь, что все зависимости установлены, и перезапустите сервер.  
- Проверьте, что путь к моделям корректно указан (например, в переменной `MODEL_PATH`).  

### Как улучшить точность моделей?
- Попробуйте изменить гиперпараметры модели, такие как количество деревьев в случайном лесе или глубину деревьев.  
- Используйте другие алгоритмы машинного обучения, такие как XGBoost.  

### Как интегрировать API в другую систему?
- Используйте библиотеку `requests` для отправки запросов к API. Рекомендуется использовать асинхронные запросы для повышения производительности.  

## 6. Контакты и поддержка

Для связи с разработчиком:  
- **Имя:** Владислав  
- **Телефон:** +7-938-120-70-55  
- **Электронная почта:** vladiс.lyapin@yandex.ru  
